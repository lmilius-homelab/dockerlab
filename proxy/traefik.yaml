api:
  dashboard: true

log:
  level: DEBUG

providers:
  file:
    filename: /etc/traefik/traefik.yaml
    watch: true
  docker:
    exposedByDefault: false

entrypoints:
  web:
    address: ":80"
  websecure:
    address: ":443"


certificatesResolvers:
  cloudflare:
    acme:
      dnschallenge:
        provider: cloudflare
        resolvers:
        - "1.1.1.1:53"
      # When doing testing, uncomment the below line to prevent hitting LetsEncrypt limits
      caserver: https://acme-staging-v02.api.letsencrypt.org/directory
      email: info@lukemilius.com
      storage: /letsencrypt/acme.json


# http to https redirection
http:
  routers:
    http_catchall:
      entryPoints:
        - web
      middlewares:
        - https_redirect
      rule: "HostRegexp(`{any:.+}`)"
      service: noop@internal

  middlewares:
    github_auth:
      forwardAuth:
        address: "https://auth.lukemilius.com/oauth2/auth"
        trustForwardHeader: true
        authResponseHeaders:
        - "X-Forwarded-User"
    https_redirect:
      redirectScheme:
        scheme: https
        permanent: true
